---
title: "Lock Positions"
weight: 1
---

# Lock Positions

Signals represents locked token positions as [Non-Fungible Tokens (ERC721)](https://en.wikipedia.org/wiki/ERC-721). Each NFT represents ownership of tokens locked in support of an initiative, which can be redeemed after the initiative reaches a terminal state (Accepted or Expired).

## TokenLock Structure

Each lock position contains the following information:

```solidity
struct TokenLock {
    uint256 initiativeId;      // ID of the initiative being supported
    uint256 tokenAmount;        // Amount of tokens locked
    uint256 lockDuration;       // Total duration of the lock in intervals
    uint256 created;            // Timestamp when lock was created
    bool withdrawn;             // Whether tokens have been redeemed
}
```

## Creating Lock Positions

Lock positions can be created in two ways:

### 1. Propose Initiative With Lock

Create a new initiative and immediately lock tokens in support:

```solidity
uint256 tokenId = signals.proposeInitiativeWithLock(
    "Initiative Title",
    "Initiative description...",
    30_000 * 1e18,  // 30,000 tokens
    6               // 6 intervals
);
```

### 2. Support Existing Initiative

Lock tokens in support of an existing initiative:

```solidity
uint256 tokenId = signals.supportInitiative(
    initiativeId,
    30_000 * 1e18,  // 30,000 tokens
    6               // 6 intervals
);
```

## Lock Duration and Intervals

Lock durations are specified in **intervals**, not time units. The length of an interval is configured at board initialization via `lockInterval`:

```solidity
// Board configured with 1 day intervals
lockInterval = 1 days;

// Locking for 6 intervals = 6 days
signals.supportInitiative(initiativeId, amount, 6);

// Locking for 12 intervals = 12 days
signals.supportInitiative(initiativeId, amount, 12);
```

**Maximum Duration:**
Boards also specify `maxLockIntervals` to limit how long tokens can be locked.

## Voting Weight

Lock positions generate voting weight that decays over time according to the board's configured decay curve:

### Linear Decay
Weight decreases proportionally with each interval:

```
weight = tokenAmount * (remainingIntervals / totalIntervals)
```

### Exponential Decay
Weight decreases exponentially, maintaining more weight in early intervals:

```
weight = tokenAmount * e^(-k * elapsedIntervals)
```

**Key Properties:**
- Longer locks generate more total weight over their lifetime
- Weight decays to zero when lock duration expires
- Weight calculation is read-only and gas-efficient

## Transferability

Lock positions are standard ERC721 tokens and can be:
- Transferred between addresses
- Traded on NFT marketplaces
- Used as collateral in other protocols
- Composed with other DeFi primitives

**Note:** The voting weight remains associated with the lock position, not the original locker. Transferring a lock position transfers its voting weight to the new owner.

## Redemption

After an initiative reaches a terminal state (Accepted or Expired), lock position holders can redeem their underlying tokens:

```solidity
signals.redeem(tokenId);
```

**Requirements:**
- Initiative must be in Accepted or Expired state
- Caller must own the token
- Tokens have not already been withdrawn

**Effects:**
- Transfers underlying tokens to the caller
- Burns the NFT
- Marks position as withdrawn

## Bond Interface

Lock positions implement the `IBondIssuer` interface for compatibility with bond trading protocols:

```solidity
interface IBondIssuer {
    struct BondInfo {
        uint256 referenceId;      // Initiative ID
        uint256 nominalValue;     // Token amount
        uint256 expires;          // Expiration timestamp
        uint256 created;          // Creation timestamp
        bool claimed;             // Whether redeemed
    }

    function getBondInfo(uint256 tokenId)
        external
        view
        returns (BondInfo memory);
}
```

This allows lock positions to be traded on secondary markets as bonds representing future token value.

## Querying Lock Positions

### Get Lock Details
```solidity
TokenLock memory lock = signals.getTokenLock(tokenId);
```

### Get All Locks for Initiative
```solidity
uint256[] memory tokenIds = signals.getPositionsForInitiative(initiativeId);
```

### Get All Locks for Address
```solidity
uint256[] memory tokenIds = signals.getLocksForSupporter(supporter);
```

### Get Current Voting Weight
```solidity
// Weight for entire initiative
uint256 weight = signals.getWeight(initiativeId);

// Weight at specific timestamp
uint256 historicalWeight = signals.getWeightAt(initiativeId, timestamp);

// Weight for specific supporter
uint256 supporterWeight = signals.getWeightForSupporterAt(
    initiativeId,
    supporter,
    timestamp
);
```

## NFT Metadata

Lock positions are ERC721 tokens with:

**Token Name:** `{UnderlyingToken} Locked Support`
- Example: `"USDC Locked Support"`

**Token Symbol:** `sx{UnderlyingSymbol}`
- Example: `"sxUSDC"`

**Token URI:** Currently returns empty string (metadata can be added via future upgrades)

## Events

### InitiativeSupported
Emitted when tokens are locked in support of an initiative:

```solidity
event InitiativeSupported(
    uint256 indexed initiativeId,
    address indexed supporter,
    uint256 tokenAmount,
    uint256 lockDuration,
    uint256 tokenId
);
```

### Redeemed
Emitted when a lock position is redeemed:

```solidity
event Redeemed(
    uint256 indexed tokenId,
    address indexed actor,
    uint256 amount
);
```

## Example: Complete Flow

```solidity
// 1. Create initiative with lock
uint256 tokenId = signals.proposeInitiativeWithLock(
    "Build Community Center",
    "Proposal to build...",
    50_000 * 1e18,  // Lock 50k tokens
    12              // For 12 intervals
);

// 2. Check current weight
uint256 weight = signals.getWeight(initiativeId);

// 3. Transfer position to another address
signals.transferFrom(msg.sender, recipient, tokenId);

// 4. Initiative gets accepted
// (Owner calls acceptInitiative)

// 5. Redeem tokens
signals.redeem(tokenId);  // Returns 50k tokens to current owner
```
